# ~/saas-bars-platform/docker-compose.yaml

services:
  # NATS - sistema de mensajer√≠a
  nats:
    image: nats:2.10
    container_name: saasbars-nats
    ports:
      - "4222:4222"   # Client port
      - "8222:8222"   # Monitoring port   
  # PostgreSQL - base de datos
  postgres:
    image: postgres:16
    container_name: saasbars-postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: saasbars
      POSTGRES_USER: saasbars
      POSTGRES_PASSWORD: saasbars
    volumes:
      - postgres_:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U saasbars -d saasbars"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Auth service
  auth:
    build:
      context: .
      dockerfile: apps/auth/Dockerfile
    container_name: saasbars-auth
    ports:
      - "3001:3001"
    environment:
      - AUTH_PORT=3001
      - JWT_SECRET=supersecret_jwt_key_32chars_exactly!!
      - DATABASE_URL=postgresql://saasbaras:saasbars@localhost:5432/saasbars
      - NATS_URL=nats://nats:4222
    depends_on:
    - nats
    - postgres
volumes:
  postgres_: